<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">
    <title>tests</title>
  </head>
  <body>
  	<div id="tests">
	    <h1>tests</h1>
	    
	    <ul id="test-list">
	    Loading...
	    </ul>
    </div>
    
    <div id="gamebox"></div>

    <script src="http://dart.googlecode.com/svn/branches/bleeding_edge/dart/client/dart.js"></script>
    <script type="application/dart">
    #import('dart:html');

	getQueryArgs() {
	  var queryString = window.location.search;
	  var result = {};
	  if (queryString.length < 1) {
	    return result;
	  } else {
	    queryString = queryString.substring(1);
	  }
	  for (var arg in queryString.split('&')) {
	    var pair = arg.split('=');
	    result[pair[0]] = pair[1];
	  }
	  return result;
	}
	
	main () {
	  var testTitles = {
	    'action_place':      'Place Action',
	    'action_moveby':     'MoveBy Action',
	    'action_moveto':     'MoveTo Action',
	    'action_rotateby':   'RotateBy Action',
	    'action_rotateto':   'RotateTo Action',
	    'action_scaleby':    'ScaleBy Action',
	    'action_scaleto':    'ScaleTo Action',
	    'action_visibility': 'Visibility Actions',
	    'action_blink':      'Blink Action'
	  };
	
	  var testName = getQueryArgs()['test'];
	  if (testName == null) {
	    query('#test-list').text = '';
	    testTitles.forEach((key, value) {
	      var listItem = new LIElement();
	      var link = new AnchorElement('${window.location.href}?test=${key}');
	      link.text = value;
	      listItem.elements.add(link);
	      query('#test-list').elements.add(listItem);
	    });
	  } else {
	    var title = testTitles[testName];
	    if (title == null) {
	      throw 'Unknown test';
	    }
	    var script = new ScriptElement();
	    script.type = 'application/dart';
	    script.src = 'test_${testName}.dart';
	    document.body.elements.add(script);
	
	    window.document.title = title;
	    query('#tests').hidden = true;
	  }
	}
    </script>
  </body>
</html>
